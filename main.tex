\documentclass[12pt, letterpaper]{book}

\usepackage{luacode}
\begin{luacode}
  weeks = {
    "Week 1 (September 5 and 6)",
    "Week 2 (September 9 to 13)",
    "Week 3 (September 16 to 20)",
    "Week 4 (September 23 to 27)",
    "Week 5 (September 30 to October 4)",
    "Week 6 (October 7 to 11)",
    "Week 7 (October 14 to 18)",
    "Week 8 (October 21 to 25)",
    "Week 9 (October 28 to November 1)",
    "Week 10 (November 4 to 8)",
    "Week 11 (November 11 to 15)",
    "Week 12 (November 18 to 22)",
    "Week 13 (November 25 to 29)",
    "Week 14 (December 2 to 6)",
  }
\end{luacode}

\def\theauthor{Kelvin Chan}
\def\theinstitute{University of Western Ontario}
\def\thecourseterm{Fall}
\def\thecourseyear{2024}
\def\thecoursesubj{Calc}
\def\thecoursenumb{1000A}
\def\thecoursesect{002}
\def\thecoursename{Calculus I}
\def\thecoursetitle{\thecoursesubj~\thecoursenumb~\thecoursesect: \thecoursename}
\def\thecoursecoordinator{}
\def\thecourseinstructor{\theauthor}
\def\thecourselms{BrightSpace}

\def\thecoursetextbooktitle{Calculus, Volume 1}
\def\thecoursetextbookurl{\url{https://openstax.org/details/books/calculus-volume-1}}
\def\thecoursetextbookpublisher{OpenStax}
\def\thecoursetextbook{\href{https://openstax.org/details/books/calculus-volume-1}{\thecoursetextbooktitle}}

\newcommand{\theweek}[1]{\directlua{tex.print(weeks[#1])}}

% ------------------------------------------------------------
%
%             TITLE
%
% ------------------------------------------------------------
\title{\thecoursetitle}
\author{\theauthor}
\date{\today}


% ------------------------------------------------------------
%
%             PAGE SETUP
%
% ------------------------------------------------------------
\usepackage[margin=0.75in, top=0.25in, bottom=0.25in, nofoot, nomarginpar, includehead, includefoot, headheight=15pt, footskip=5pt]{geometry}

% header and footers
\usepackage{fancyhdr} % must be loaded after geometry

% base style for all pages
\fancypagestyle{base}{
  \fancyhf{}
  \fancyhead[OR, EL]{\small Page~\thepage}
  \renewcommand{\headrulewidth}{0pt}
}
\pagestyle{base}

\fancypagestyle{draft}[base]{
  \fancyhead[OL, ER]{\small \hlwarn{Draft}}
  \renewcommand{\headrulewidth}{.4pt}
}

% base style for the first page of a chapter
\fancypagestyle{firstpage}[base]{
  \fancyhead[OL, ER]{\small \thecoursesubj{}~\thecoursenumb~\thecoursesect{}}
  \renewcommand{\headrulewidth}{.4pt}
}

% for syllabus
\fancypagestyle{syllabus}[firstpage]{
  \fancyhead[C]{\small Syllabus}
}

% one style for each week of class
\fancypagestyle{week1}[firstpage]{\fancyhead[C]{\small\theweek{1}} }
\fancypagestyle{week2}[firstpage]{\fancyhead[C]{\small\theweek{2}} }
\fancypagestyle{week3}[firstpage]{\fancyhead[C]{\small\theweek{3}} }
\fancypagestyle{week4}[firstpage]{\fancyhead[C]{\small\theweek{4}} }
\fancypagestyle{week5}[firstpage]{\fancyhead[C]{\small\theweek{5}} }
\fancypagestyle{week6}[firstpage]{\fancyhead[C]{\small\theweek{6}} }
\fancypagestyle{week7}[firstpage]{\fancyhead[C]{\small\theweek{7}} }
\fancypagestyle{week8}[firstpage]{\fancyhead[C]{\small\theweek{8}} }
\fancypagestyle{week9}[firstpage]{\fancyhead[C]{\small\theweek{9}} }
\fancypagestyle{week10}[firstpage]{\fancyhead[C]{\small\theweek{10}} }
\fancypagestyle{week11}[firstpage]{\fancyhead[C]{\small\theweek{11}} }
\fancypagestyle{week12}[firstpage]{\fancyhead[C]{\small\theweek{12}} }
\fancypagestyle{week13}[firstpage]{\fancyhead[C]{\small\theweek{13}} }
\fancypagestyle{week14}[firstpage]{\fancyhead[C]{\small\theweek{14}} }

\newcommand{\makelectureweek}[1]{

  % chapter and section numbering
  \setcounter{chapter}{#1}
  \setcounter{section}{0}

  % add to TOC
  \phantomsection{}\label{week#1}
  \addcontentsline{toc}{chapter}{\theweek{#1}}

  \thispagestyle{week#1}
}

\newenvironment{lesson}[1]{
  % before code
  \def\thistextbooksectionnumber{#1}
  \section{#1}
}{
  % after code
}

% ------------------------------------------------------------
%
%           PACKAGES
%
% ------------------------------------------------------------
% colours
\input{./colours.tex.preamble}

% math
\usepackage{amsmath, amsthm, amssymb, amsfonts}
\usepackage{cancel}
\everymath{\displaystyle}

% typography
\usepackage{fontspec}
\usepackage{microtype} 
\usepackage{parskip}
\usepackage{ragged2e}

% embedded markups
\usepackage{markdown}

% subfiles
\usepackage{refcount, xr, subfiles}

% links and references
\usepackage[hidelinks, pdfusetitle]{hyperref}
\renewcommand{\UrlFont}{\footnotesize\ttfamily}

% lists
\usepackage[inline]{enumitem}

% figures
\usepackage{float}

% plots
\usepackage{tikz}
\usepackage{pgfplots}
\pgfplotsset{compat=1.18}
\pgfplotsset{trig format=rad} 
\pgfplotsset{label style={font=\footnotesize}}

% tables
\usepackage{booktabs}

% framed callout boxes
\usepackage[framemethod=tikz]{mdframed}
\mdfdefinestyle{wide}{
  % userdefinedwidth=0.95\textwidth,
  innertopmargin=1em,
  innerleftmargin=1em,
  innerbottommargin=1em,
  innerrightmargin=1em,
  skipabove=1em,
  skipbelow=1em,
  align=center,
  roundcorner=3pt,
}
\mdfdefinestyle{simple}{
  userdefinedwidth=0.9\textwidth,
  innertopmargin=1em,
  innerleftmargin=1em,
  innerbottommargin=1em,
  innerrightmargin=1em,
  skipabove=1em,
  skipbelow=1em,
  align=center,
  roundcorner=3pt,
  startinnercode={\linespread{1.5}\selectfont}
}

\mdfdefinestyle{simple-compact}{
  userdefinedwidth=0.9\textwidth,
  innertopmargin=1em,
  innerleftmargin=1em,
  innerbottommargin=1em,
  innerrightmargin=1em,
  skipabove=1em,
  skipbelow=1em,
  align=center,
  roundcorner=3pt,
}

\mdfdefinestyle{sidenote}{
  userdefinedwidth=0.3\textwidth,
  innertopmargin=1em,
  innerleftmargin=1em,
  innerbottommargin=1em,
  innerrightmargin=1em,
  skipabove=1em,
  skipbelow=1em,
  align=right,
  topline=false,
  rightline=false,
  bottomline=false,
  startinnercode={\footnotesize}
}

\mdfdefinestyle{withref}{
  userdefinedwidth=0.9\textwidth,
  innertopmargin=1em,
  innerleftmargin=1em,
  innerbottommargin=0.25em,
  innerrightmargin=1em,
  skipabove=1em,
  skipbelow=1em,
  align=center,
  roundcorner=3pt,
  startinnercode={\linespread{1.5}\selectfont}
}

\mdfdefinestyle{withref-compact}{
  userdefinedwidth=0.9\textwidth,
  innertopmargin=1em,
  innerleftmargin=1em,
  innerbottommargin=0.25em,
  innerrightmargin=1em,
  skipabove=1em,
  skipbelow=1em,
  align=center,
  roundcorner=3pt,
}

% fonts
\usepackage[mathcal]{euscript}
\usepackage{fontawesome5}

% section titles
\usepackage[sc,center,tiny]{titlesec}
\titlelabel{\thetitle.\;}


% ------------------------------------------------------------
%
%           Math
%
% ------------------------------------------------------------
\theoremstyle{definition}
\newtheorem{thm}{Theorem}
\newtheorem{example}[thm]{Example}

\newcommand{\textbook}[1]{\noindent{} {\footnotesize \faBookReader{} #1 \hfill}}
\newcommand{\stewart}[1]{#1}

% better looking symbols
\renewcommand{\epsilon}{\varepsilon}
\renewcommand{\emptyset}{\varnothing}


% ------------------------------------------------------------
%
%           Fill in the blanks
%
% ------------------------------------------------------------
\newcommand{\blanklines}[2][40]{
  % assume textarea is 7in wide.
  % need to scale ever so slightly to avoid overfull box warning
  \par{}
  \begin{tikzpicture}[x=.175in,y=.175in,scale=0.99]
    \foreach \x in {0,1,...,#1}
    {
      \foreach \y in {0,1,...,#2}
      {
        \fill[gray!40] (\x,\y) circle[radius=0.5pt];
      }
    }
  \end{tikzpicture}
  \smallskip
}

\begin{document}
  % --------------------
  % 
  % TITLE PAGE
  % 
  % --------------------
  \begin{titlepage}
    \thispagestyle{empty}
    \huge
    
    \begin{center}
      % title
      \phantom{top}
      \vspace{1in}

      {\Huge\bfseries \thecoursetitle}

      \vspace{1cm}
      \theauthor

      \theinstitute
      \vfill{}

      \thecourseterm~\thecourseyear

      \vspace{2in}
    \end{center}

    % creaate a blank page
    \clearpage{\thispagestyle{empty}\cleardoublepage}
  \end{titlepage}

  % --------------------
  % 
  % FRONT MATTER
  % 
  % --------------------
  \frontmatter{}
  \pagenumbering{roman}
  
  \renewcommand{\contentsname}{Table of Contents}
  \phantomsection{} \label{toc}
  \addcontentsline{toc}{chapter}{\contentsname}
  \tableofcontents{}
  \clearpage

  \clearpage{\thispagestyle{empty}\cleardoublepage}

  
  %--------------------
  % 
  % MAIN MATTER
  % 
  % --------------------
  \mainmatter{}

  \subfile{./lectures/week1.tex} \clearpage{\thispagestyle{empty}\cleardoublepage}
  \subfile{./lectures/week2.tex} \clearpage{\thispagestyle{empty}\cleardoublepage}
  \subfile{./lectures/week3.tex} \clearpage{\thispagestyle{empty}\cleardoublepage}
  \subfile{./lectures/week4.tex} \clearpage{\thispagestyle{empty}\cleardoublepage}
  \subfile{./lectures/week5.tex} \clearpage{\thispagestyle{empty}\cleardoublepage}
  \subfile{./lectures/week6.tex} \clearpage{\thispagestyle{empty}\cleardoublepage}
  \subfile{./lectures/week7.tex} \clearpage{\thispagestyle{empty}\cleardoublepage}
  \subfile{./lectures/week8.tex} \clearpage{\thispagestyle{empty}\cleardoublepage}
  \subfile{./lectures/week9.tex} \clearpage{\thispagestyle{empty}\cleardoublepage}
  \subfile{./lectures/week10.tex} \clearpage{\thispagestyle{empty}\cleardoublepage}
  \subfile{./lectures/week11.tex} \clearpage{\thispagestyle{empty}\cleardoublepage}
  \subfile{./lectures/week12.tex} \clearpage{\thispagestyle{empty}\cleardoublepage}
  \subfile{./lectures/week13.tex} \clearpage{\thispagestyle{empty}\cleardoublepage}
  \subfile{./lectures/week14.tex} \clearpage{\thispagestyle{empty}\cleardoublepage}

  %--------------------
  % 
  % BACK MATTER
  % 
  % --------------------
  \backmatter{}
\end{document}
